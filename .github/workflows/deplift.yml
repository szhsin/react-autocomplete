name: Dependency update (deplift)

on:
  schedule:
    - cron: '0 16 * * 5'
  workflow_dispatch: {}
# on: push

permissions:
  contents: write
  pull-requests: write

jobs:
  update-dependencies:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: 24

      - run: npx --yes deplift@latest

      - run: npm test

      - run: npm run build

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          branch: chore/deplift
          title: 'chore(deps): update all dependencies to latest versions'
          body: |
            Automated dependency update generated by GitHub Actions.

            This workflow:
            - Updated dependencies using [deplift](https://github.com/szhsin/deplift)
            - Ran tests
            - Ran the build and committed any generated changes
          committer: 'Zheng Song <41896553+szhsin@users.noreply.github.com>'
          commit-message: 'chore(deps): update all dependencies'
          labels: |
            dependencies
            automated
